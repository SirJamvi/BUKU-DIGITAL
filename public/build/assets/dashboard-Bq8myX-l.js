document.addEventListener("DOMContentLoaded",function(){const p=window.dashboardData||{},l=p.fundAllocation||[],o=p.monthlyPerformance||null,i=p.weeklyPerformance||null,v=document.getElementById("fundAllocationChart");if(!v){console.error("Fund Allocation Chart canvas not found!");return}const A=v.getContext("2d");let d,f,u;const y=["#28a745","#007bff","#ffc107","#17a2b8","#6f42c1","#fd7e14","#e83e8c","#20c997"];l&&l.length>0?(f=l.map(e=>e.allocation_name),d=l.map(e=>parseFloat(e.percentage)),u=l.map((e,t)=>y[t%y.length])):(f=["Gaji Owner","Reinvestasi","Dana Darurat","Ekspansi"],d=[40,30,20,10],u=["#28a745","#007bff","#ffc107","#17a2b8"]);const s=new Chart(A,{type:"doughnut",data:{labels:f,datasets:[{data:d,backgroundColor:u,borderWidth:3,borderColor:"#fff",cutout:"70%",hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.85)",titleColor:"#ffffff",bodyColor:"#ffffff",titleFont:{size:14,weight:"bold"},bodyFont:{size:13},cornerRadius:8,padding:12,displayColors:!0,callbacks:{label:function(e){const t=e.parsed,a=e.dataset.data.reduce((k,b)=>k+b,0),r=(t/a*100).toFixed(1);return`${e.label}: ${r}%`}}}},interaction:{intersect:!1,mode:"index"},onHover:(e,t)=>{e.native.target.style.cursor=t.length>0?"pointer":"default"}}});w();function w(){const e=document.getElementById("fundAllocationLegend");if(!e){console.error("Legend container #fundAllocationLegend not found!");return}const t=d.reduce((a,r)=>a+r,0);if(e.innerHTML="",t===0){e.innerHTML=`
                <div class="empty-legend">
                    <i class="fas fa-info-circle"></i>
                    <p>Belum ada pengaturan alokasi dana</p>
                </div>
            `;return}f.forEach((a,r)=>{const b=(d[r]/t*100).toFixed(1),I=u[r],c=document.createElement("div");c.className="fund-legend-item",c.innerHTML=`
                <div class="legend-color" style="background-color: ${I};"></div>
                <div class="legend-content">
                    <div class="legend-label">${a}</div>
                    <div class="legend-percentage">${b}%</div>
                </div>
            `,c.addEventListener("mouseenter",()=>{s.setActiveElements([{datasetIndex:0,index:r}]),s.tooltip.setActiveElements([{datasetIndex:0,index:r}]),s.update()}),c.addEventListener("mouseleave",()=>{s.setActiveElements([]),s.tooltip.setActiveElements([]),s.update()}),e.appendChild(c)})}const C=document.getElementById("comprehensiveChart");if(!C){console.error("Comprehensive Chart canvas not found!");return}const L=C.getContext("2d");let m,g,h;o&&o.labels?(m=o.labels,g=o.sales,h=o.profits):(m=["Jan","Feb","Mar","Apr","Mei","Jun"],g=[0,0,0,0,0,0],h=[0,0,0,0,0,0]);const n=new Chart(L,{type:"line",data:{labels:m,datasets:[{label:"Penjualan (Jt)",data:g,borderColor:"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",fill:!0,tension:.4,pointRadius:6,pointHoverRadius:8,pointBackgroundColor:"#007bff",pointBorderColor:"#ffffff",pointBorderWidth:2},{label:"Laba Bersih (Jt)",data:h,borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",fill:!0,tension:.4,pointRadius:6,pointHoverRadius:8,pointBackgroundColor:"#28a745",pointBorderColor:"#ffffff",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.05)",drawBorder:!1},ticks:{callback:function(e){return"Rp "+e+" Jt"},color:"#6c757d"}},x:{grid:{display:!1},ticks:{color:"#6c757d"}}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"600"}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",cornerRadius:8,padding:12,callbacks:{label:function(e){return e.dataset.label+": Rp "+e.parsed.y+" Jt"}}}}}});document.querySelectorAll('input[name="chartPeriod"]').forEach(e=>{e.addEventListener("change",function(){this.id==="weekly"?i&&i.labels?(n.data.labels=i.labels,n.data.datasets[0].data=i.sales,n.data.datasets[1].data=i.profits):(n.data.labels=["M1","M2","M3","M4"],n.data.datasets[0].data=[0,0,0,0],n.data.datasets[1].data=[0,0,0,0]):o&&o.labels&&(n.data.labels=o.labels,n.data.datasets[0].data=o.sales,n.data.datasets[1].data=o.profits),n.update()})});const x={threshold:.1,rootMargin:"0px 0px -50px 0px"},D=new IntersectionObserver(e=>{e.forEach(t=>{t.isIntersecting&&(t.target.style.opacity="1",t.target.style.transform="translateY(0)")})},x);document.querySelectorAll(".metric-card").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",D.observe(e)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const a=document.querySelector(this.getAttribute("href"));a&&a.scrollIntoView({behavior:"smooth",block:"start"})})}),document.querySelectorAll(".quick-action-item").forEach(e=>{e.addEventListener("click",function(t){const a=this.querySelector(".action-icon i");if(a){const r=a.className;a.className="fas fa-spinner fa-spin",setTimeout(()=>{a.className=r},500)}})}),document.querySelectorAll(".metric-card").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateY(-5px) scale(1.02)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"})});function B(){document.querySelectorAll(".progress-bar").forEach(e=>{const t=e.style.width;e.style.width="0%",setTimeout(()=>{e.style.width=t},100)})}setTimeout(B,500);function E(){const e=new Date,t={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},a=document.querySelector(".dashboard-date span");a&&(a.textContent=e.toLocaleDateString("id-ID",t))}E(),setInterval(E,6e4)});
